{% extends "base.html" %}

{% block title %}Editar Usuário - {{ store_settings.store_name }}{% endblock %}

{% block content %}
<div class="content_section" style="margin-top: 30px;">
    <h2 style="font-size: 28px; margin-bottom: 30px; color: #111;">
        <i class="fa fa-user-edit"></i> Editar Usuário: {{ user.username }}
    </h2>

    <div style="background: #fff; padding: 40px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 600px; margin: 0 auto;">
        <form method="POST">
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                    Nome de Usuário <span style="color: #dc3545;">*</span>
                </label>
                <input type="text" name="username" value="{{ user.username }}" required class="input" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" placeholder="Digite o nome de usuário">
            </div>

            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                    Email <span style="color: #dc3545;">*</span>
                </label>
                <input type="email" name="email" value="{{ user.email }}" required class="input" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" placeholder="Digite o email">
            </div>

            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                    Nova Senha
                </label>
                <input type="password" name="password" class="input" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" placeholder="Deixe em branco para manter a senha atual" minlength="6">
                <small style="color: #666; font-size: 12px;">Deixe em branco se não quiser alterar a senha</small>
            </div>

            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">CPF</label>
                <input type="text" name="cpf" value="{{ user.cpf if user.cpf else '' }}" class="input" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" placeholder="000.000.000-00" maxlength="14">
            </div>

            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Telefone</label>
                <input type="tel" name="phone" value="{{ user.phone if user.phone else '' }}" class="input" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" placeholder="(00) 00000-0000">
            </div>

            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                    Papel no Sistema <span style="color: #dc3545;">*</span>
                </label>
                <select name="role" required class="input" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;">
                    <option value="customer" {% if user.role == 'customer' %}selected{% endif %}>Cliente</option>
                    <option value="waiter" {% if user.role == 'waiter' %}selected{% endif %}>Atendente (PDV)</option>
                    <option value="kitchen" {% if user.role == 'kitchen' %}selected{% endif %}>Cozinha</option>
                    <option value="manager" {% if user.role == 'manager' %}selected{% endif %}>Gerente</option>
                </select>
                <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                    <strong>Atendente:</strong> Acessa PDV, gerencia mesas, caixa e pedidos.<br>
                    <strong>Cozinha:</strong> Visualiza e atualiza pedidos na cozinha.<br>
                    <strong>Gerente:</strong> Acesso completo ao PDV e relatórios.
                </small>
            </div>

            <div style="margin-bottom: 30px;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="is_admin" {% if user.is_admin %}checked{% endif %} style="margin-right: 10px; width: 18px; height: 18px;">
                    <span style="font-weight: 600; color: #333;">Acesso Administrativo</span>
                </label>
                <small style="color: #666; font-size: 12px; margin-left: 28px; display: block; margin-top: 5px;">
                    Marque apenas se o usuário deve ter acesso total ao painel administrativo
                </small>
            </div>

            <div style="display: flex; gap: 15px; justify-content: center;">
                <button type="submit" class="btn" style="background: var(--color-red); color: #fff; padding: 12px 40px; border-radius: 6px; border: none; cursor: pointer; font-weight: 600;">
                    <i class="fa fa-save"></i> Salvar Alterações
                </button>
                <a href="{{ url_for('admin.users') }}" class="btn" style="background: #999; color: #fff; padding: 12px 40px; border-radius: 6px; text-decoration: none; font-weight: 600;">
                    <i class="fa fa-times"></i> Cancelar
                </a>
            </div>
        </form>
    </div>
</div>

<script>
document.querySelector('input[name="cpf"]').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length <= 11) {
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
        e.target.value = value;
    }
});

document.querySelector('input[name="phone"]').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length <= 11) {
        value = value.replace(/^(\d{2})(\d)/g, '($1) $2');
        value = value.replace(/(\d)(\d{4})$/, '$1-$2');
        e.target.value = value;
    }
});
</script>
{% endblock %}
