{% extends "base.html" %}

{% block title %}PDV / Salão - {{ store_settings.store_name }}{% endblock %}

{% block content %}
<div class="pdv-container">
    <div class="pdv-card">
        <h2 style="margin: 0;"><i class="fa fa-cutlery"></i> PDV / Salão</h2>
    </div>
    
    <div class="pdv-shortcut-grid">
        <a href="{{ url_for('pdv.tables') }}" class="pdv-shortcut-card green">
            <i class="fa fa-th pdv-shortcut-icon"></i>
            <div class="pdv-shortcut-label">Mesas</div>
        </a>
        
        <a href="{{ url_for('pdv.cash_register') }}" class="pdv-shortcut-card orange">
            <i class="fa fa-money pdv-shortcut-icon"></i>
            <div class="pdv-shortcut-label">Caixa</div>
        </a>
        
        <a href="{{ url_for('kitchen.kds') }}" class="pdv-shortcut-card red">
            <i class="fa fa-fire pdv-shortcut-icon"></i>
            <div class="pdv-shortcut-label">Cozinha (KDS)</div>
        </a>
        
        <a href="{{ url_for('admin.dashboard') }}" class="pdv-shortcut-card dark">
            <i class="fa fa-dashboard pdv-shortcut-icon"></i>
            <div class="pdv-shortcut-label">Admin</div>
        </a>
    </div>
    
    <div class="pdv-card">
        <h3><i class="fa fa-info-circle"></i> Status do Caixa</h3>
        {% if open_cash %}
            <div class="pdv-status-open" style="font-size: 18px; margin-bottom: 10px;">
                <i class="fa fa-check-circle"></i> Caixa Aberto
            </div>
            <p><strong>Aberto por:</strong> {{ open_cash.user.username }}</p>
            <p><strong>Saldo inicial:</strong> R$ {{ "%.2f"|format(open_cash.opening_balance) }}</p>
            <p><strong>Saldo atual:</strong> R$ {{ "%.2f"|format(open_cash.calculate_expected_balance()) }}</p>
        {% else %}
            <div class="pdv-status-closed" style="font-size: 18px;">
                <i class="fa fa-times-circle"></i> Nenhum caixa aberto
            </div>
            <a href="{{ url_for('pdv.cash_register') }}" class="btn btn-primary" style="margin-top: 15px;">Abrir Caixa</a>
        {% endif %}
    </div>
    
    {% if open_comandas %}
    <div class="pdv-card">
        <h3><i class="fa fa-list"></i> Comandas Abertas ({{ open_comandas|length }})</h3>
        <div style="overflow-x: auto;">
            <table class="pdv-table">
                <thead>
                    <tr>
                        <th>Comanda #</th>
                        <th>Mesa</th>
                        <th>Cliente</th>
                        <th style="text-align: right;">Total</th>
                        <th style="text-align: center;">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for comanda in open_comandas %}
                    <tr>
                        <td>{{ comanda.comanda_number }}</td>
                        <td>{% if comanda.table %}Mesa {{ comanda.table.table_number }}{% else %}-{% endif %}</td>
                        <td>{{ comanda.customer_name or '-' }}</td>
                        <td style="text-align: right; font-weight: 600;">R$ {{ "%.2f"|format(comanda.total) }}</td>
                        <td style="text-align: center;">
                            <a href="{{ url_for('pdv.comanda_detail', comanda_id=comanda.id) }}" class="btn btn-sm btn-primary">Ver</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
